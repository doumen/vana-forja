name: üöÄ Forja HariKatha v6.1 Diamond

on:
  workflow_dispatch:
    inputs:
      source_url:
        description: 'URL da Aula (YouTube ou Facebook)'
        required: true
      post_id:
        description: 'ID do Post no WordPress'
        required: true
      target_lang:
        description: 'Idioma Final (pt, en, es)'
        default: 'pt'
        required: true
      start:
        description: 'Corte Inicial (HH:MM:SS) - Opcional'
        required: false
      end:
        description: 'Corte Final (HH:MM:SS) - Opcional'
        required: false

jobs:
  forge_vashnava_vani:
    runs-on: ubuntu-latest
    
    # --- üèóÔ∏è INJE√á√ÉO DE SEGREDOS COMO VARI√ÅVEIS DE AMBIENTE ---
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      WP_URL: ${{ secrets.WP_URL }}
      WP_USER: ${{ secrets.WP_USER }}
      WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
      DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}

    steps:
      - name: üì• Checkout do Reposit√≥rio
        uses: actions/checkout@v4

      - name: üêç Configurar Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: üõ†Ô∏è Instalar Depend√™ncias de Sistema (FFmpeg)
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: üì¶ Instalar Requisitos Python
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: üî• EXECUTAR MAESTRO (FORJA)
        run: |
          python vana_orchestrator.py \
            --source_url "${{ github.event.inputs.source_url }}" \
            --post_id ${{ github.event.inputs.post_id }} \
            --target_lang "${{ github.event.inputs.target_lang }}" \
            ${{ github.event.inputs.start && format('--start {0}', github.event.inputs.start) || '' }} \
            ${{ github.event.inputs.end && format('--end {0}', github.event.inputs.end) || '' }} \
            --publish

      - name: üìÇ Upload de Artefatos (Logs e Dados)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: forja-outputs-${{ github.run_id }}
          path: |
            work/transcripts/*.txt
            work/edited/*.txt
            work/stats.json
          retention-days: 5